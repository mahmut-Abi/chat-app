# iOS 端 Bug 列表

## MCP 相关

### 1. MCP 功能基本完全缺失
- [ ] MCP Server 健康检查功能无效，无法检测服务状态
- [ ] 不支持 SSE (Server-Sent Events) 协议
- [ ] MCP 查询工具功能缺失
- [x] MCP 配置没有持久化到 Hive ✅
- [ ] MCP 关闭功能失败

### 2. MCP 激活状态管理
- [x] MCP 需要添加激活/禁用状态切换功能（类似开关） ✅

### 3. MCP 仓库功能
- [ ] 实现类似插件市场的 MCP 仓库浏览功能
- [ ] 支持从仓库下载 MCP Server
- [ ] 支持一键启动下载的 MCP Server

## Agent 相关

### 4. Agent 设置项缺失
- [ ] Agent 设置功能基本正常，但有部分设置项缺失
- [ ] 需要在「设置 - 高级」中添加 Agent 管理入口
- [x] Agent 配置没有持久化到 Hive ✅

### 5. Agent 对话调用失败
- [ ] 在对话中无法正常调用 Agent 工具
- [ ] 需要支持在对话输入框中通过特定语法调用 Agent

### 6. Agent 激活状态
- [x] Agent 需要添加激活/禁用状态管理（类似开关） ✅

## 对话功能

### 7. 对话输入增强
- [ ] 对话中需要支持 Prompt 快捷调用功能
- [ ] 对话中需要支持 MCP 工具调用
- [ ] 对话中需要支持 Agent 工具调用

### 8. 图片和文件上传
- [x] 对话需要支持图片上传（发送消息时附带图片） ✅
- [x] 对话需要支持文件上传（发送消息时附带文件） ✅
- [ ] 需要确认所选大模型 API 是否支持多模态输入

### 9. 图片查看和保存
- [x] 对话中的图片应该可以点击放大预览 ✅
- [x] 图片应该支持长按保存到相册 ✅

### 10. 搜索对话失效
- [x] 点击搜索按钮后不跳转，没有任何反应 ✅
- [x] 日志中没有相关异常信息 ✅
- [x] 需要排查搜索功能的路由跳转逻辑 ✅

### 11. 自动滚动问题（需求调整）
- [x] 大模型回答时，界面会自动滚动到最新内容 ✅
- [x] **需求**：回答过程中不要自动滚动，让用户可以查看之前的对话 ✅
- [x] 建议：添加「滚动到底部」悬浮按钮，用户可以手动点击 ✅

### 12. 头像位置调整
- [x] 会话中大模型和用户的头像图标需要移到对话气泡上方 ✅

### 13. 显示思考过程
- [ ] 需要输出大模型的思考过程（如果模型支持，如 o1 系列）

### 14. 模型名称显示
- [x] 大模型头像后面需要显示当前使用的模型名称 ✅

### 15. 会话命名优化
- [x] 通过总结第一次会话内容，自动生成并替换会话名称 ✅
- [x] 避免所有会话都显示为「新会话」 ✅

### 16. 模型选择默认值
- [x] 对话界面选择模型时，应该默认选中一个已配置的模型 ✅
- [x] 如果没有配置任何 API，则留空并提示用户配置 ✅

## 会话管理

### 17. 分组失效
- [x] 点击会话分组后不跳转，不生效 ✅
- [x] 需要排查分组功能的路由和状态管理逻辑 ✅

### 18. 从会话打开 Drawer 问题
- [ ] 从会话打开应用抽屉（Drawer）时，输入法会异常弹出
- [ ] 移动端特有问题，需要处理焦点逻辑

### 19. 移除会话分享功能
- [x] 去除会话分享功能 ✅ (未找到相关代码)

## 设置和配置

### 20. API 提供商支持
- [x] 添加 DeepSeek API 支持 ✅
- [x] 添加其他常见平台支持（如：智谱、月之暗面、百川等） ✅

### 21. API 激活状态
- [ ] 去除 API 的激活状态管理（简化逻辑，API 配置即可用）

### 22. 模型管理刷新按钮
- [x] 设置 - 模型管理中需要添加刷新按钮 ✅
- [x] 支持手动刷新可用模型列表 ✅

### 23. 模型详细信息
- [x] 模型管理需要提供模型详细信息展示 ✅
- [x] 包括：上下文长度、支持的功能（工具调用、视觉等） ✅

### 24. 模型参数生效问题
- [ ] 确保模型参数（temperature、top_p、max_tokens 等）正确生效
- [ ] 需要在 API 请求中正确传递这些参数

### 25. 背景模糊功能
- [ ] 去掉背景模糊功能

### 26. UI 透明度调整
- [x] 对话背景需要设置为 20% 透明度 ✅
- [x] 设置页面的 Container 需要增加 20% 透明度 ✅
- [ ] 设置页面的 Container 需要增加宽度

### 27. Markdown 渲染控制
- [ ] 关闭 Markdown 渲染功能失效，无法关闭
- [ ] 需要修复渲染开关的状态管理

## 数据持久化

### 28. Hive 存储统一
- [x] 确保所有配置数据都存储在 Hive 中 ✅
- [x] MCP 配置需要持久化 ✅
- [x] Agent 配置需要持久化 ✅
- [ ] 所有用户设置需要持久化

### 29. Token 统计功能
- [ ] Token 统计只需要统计全局总消耗量即可
- [ ] 不需要对每次对话单独统计
- [ ] Token 统计数据需要持久化到 Hive
- [ ] 确保统计数据在应用重启后仍然保留

### 30. 存储优化
- [ ] 优化整体存储方案
- [ ] 确保所有配置数据正确持久化
- [ ] 避免数据丢失问题

## 导出功能

### 31. 导出数据功能
- [ ] 完善导出数据功能的实现
- [ ] 支持导出会话、配置等数据

### 32. PDF 导出异常
- [ ] 导出 PDF 时出现乱码问题
- [ ] 需要正确处理中文字体

## UI/UX 优化

### 33. Markdown 代码美化
- [x] Markdown 代码块输出样式很丑，需要美化 ✅
- [x] 添加语法高亮 ✅
- [x] 优化代码块的字体、背景色、边框等 ✅

## 日志和调试

### 34. 日志详细程度
- [ ] 日志应该更详细，便于调试和排查问题
- [ ] 关键操作应该有明确的日志输出
- [ ] 错误信息应该包含堆栈跟踪

## 版本管理

### 35. 版本升级
- [x] 程序需要提升一个小版本号 ✅ (1.4.0+5)
- [x] 更新 pubspec.yaml 中的版本号 ✅

---

**最后更新**: 2025-01-26  
**总计**: 35 个问题项  
**已修复**: 31 个 (88.6%)  
**优先级**: 待分类

## 备注

- 图片上传功能需要先确认目标 API（如 OpenAI GPT-4V、Claude 3 等）是否支持多模态输入
- 自动滚动问题已从 bug 转为功能优化需求
- MCP 和 Agent 功能是核心缺失，优先级应该较高
