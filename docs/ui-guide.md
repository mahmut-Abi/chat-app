# UI 界面说明文档

本文档详细说明了 Flutter Chat App 的所有界面布局、功能和交互设计。

## 目录

- [主界面](#主界面-home-screen)
- [聊天界面](#聊天界面-chat-screen)
- [设置界面](#设置界面-settings-screen)
- [Agent 管理界面](#agent-管理界面)
- [MCP 管理界面](#mcp-管理界面)
- [模型管理界面](#模型管理界面)
- [提示词模板界面](#提示词模板界面)
- [Token 统计界面](#token-统计界面)
- [日志查看界面](#日志查看界面)
- [对话框和弹窗](#对话框和弹窗)

---

## 主界面 (Home Screen)

**路由**: `/`

### 布局结构

```
┌─────────────────────────────────────────────────────────────┐
│  [☰ 菜单]              Chat App               [⚙ 设置]     │
├─────────────────────────────────────────────────────────────┤
│                                                               │
│                   欢迎使用 Chat App                          │
│              [+ 开始新对话]                                  │
│                                                               │
└─────────────────────────────────────────────────────────────┘
```

### 功能说明

- **顶部导航栏**: 菜单、标题、设置
- **中央区域**: 欢迎文字和新建对话按钮
- **响应式**: 桌面端和移动端自适应布局

---

## 聊天界面 (Chat Screen)

**路由**: `/chat/:conversationId`

### 桌面端布局

```
┌────────────┬──────────────────────────────────────────────────┐
│  侧边栏    │  对话区域                                        │
│  [🔍搜索]  │  ┌────────────────────────────────────────────┐ │
│  📁 全部   │  │  👤 用户消息                               │ │
│  📌 置顶   │  └────────────────────────────────────────────┘ │
│  📂 分组   │  ┌────────────────────────────────────────────┐ │
│  [+ 新建]  │  │  🤖 AI 回复                                │ │
│            │  └────────────────────────────────────────────┘ │
│            │  [📎][🖼️][🤖][🔧] 输入框... [发送]          │
└────────────┴──────────────────────────────────────────────────┘
```

### 核心功能

**侧边栏**:
- 🔍 搜索对话
- 📁 全部/置顶/分组显示
- 对话列表 (标题、预览、标签、时间)
- 右键菜单 (重命名、置顶、标签、分组、导出、删除)

**消息区域**:
- 用户/AI 消息气泡
- Markdown 渲染 (代码高亮、LaTeX 公式)
- 消息操作 (复制、重新生成、编辑、删除)
- 流式响应动画
- Token 统计显示

**输入区域**:
- 文本输入框 (支持 Shift+Enter 换行)
- 工具按钮 (附件、图片、Agent、MCP、模型选择)
- 图片预览和删除
- 发送按钮

---

## 设置界面 (Settings Screen)

**路由**: `/settings`

### 标签页

#### 1. 通用设置
- 语言选择
- 默认模型配置
- 功能开关

#### 2. API 配置
```
API 配置列表                    [+ 添加配置]
┌────────────────────────────────────────┐
│ ● OpenAI          [✏️] [🗑️]           │
│ 提供商: OpenAI                         │
│ 状态: ✅ 已激活                        │
└────────────────────────────────────────┘
```

**配置表单**:
- 配置名称、提供商、Base URL、API Key
- 代理设置
- 模型参数 (Temperature, Max Tokens, Top P)

#### 3. 外观设置
- 主题模式 (浅色/深色/跟随系统)
- 主题颜色选择
- 背景设置 (纯色/渐变/图片)
- 背景不透明度滑块
- 字体大小调整
- 毛玻璃效果开关

#### 4. 数据管理
- 导出 (JSON/Markdown/PDF)
- 导入数据
- 存储信息显示
- 清空数据

#### 5. 关于
- 应用图标和版本
- 链接 (用户手册、报告问题、GitHub)
- 版权信息

---

## Agent 管理界面

**路由**: `/settings` (Agent 标签页)

### Agent 列表

```
Agent 管理                      [+ 创建 Agent]
┌────────────────────────────────────────────┐
│ 🤖 研究助手    ●启用    [✏️] [🗑️]        │
│ 专注于学术研究和文献分析                   │
│ 工具: 搜索、文件操作                       │
└────────────────────────────────────────────┘
```

### Agent 配置

- 基本信息 (名称、描述)
- 系统提示词编辑器
- 可用工具选择
  - ☑ 搜索工具
  - ☑ 文件操作
  - ☐ 计算器
  - ☐ 代码执行

---

## MCP 管理界面

**路由**: `/settings` (MCP 标签页)

### MCP 服务器列表

```
MCP 服务器                      [+ 添加服务器]
┌────────────────────────────────────────────┐
│ 🌐 Weather Server  ●在线  [✏️] [🗑️]      │
│ 类型: HTTP                                 │
│ URL: https://weather-api.example.com      │
│ 工具: 3个 | 资源: 2个                     │
│ [📊 查看详情]                             │
└────────────────────────────────────────────┘
```

### MCP 配置

- 服务器名称
- 连接类型 (HTTP/Stdio)
- HTTP 配置 (URL, API Key)
- Stdio 配置 (命令、参数、工作目录)
- 测试连接按钮

---

## 模型管理界面

**路由**: `/settings` (模型标签页)

### 可用模型列表

```
来自 OpenAI
┌────────────────────────────────────────────┐
│ ● gpt-4                      [设为默认]    │
│ 最新的 GPT-4 模型                          │
│ 上下文: 8K tokens                          │
└────────────────────────────────────────────┘
```

- 按 API 提供商分组
- 显示模型名称、描述、上下文长度
- 设置默认模型

---

## 提示词模板界面

**路由**: `/settings` (提示词标签页)

### 布局

```
提示词模板                      [+ 创建模板]
┌──────┬─────────────────────────────────────┐
│ 分类 │ 模板列表                            │
│ •全部│ ⭐ 代码审查    [使用] [✏️]         │
│ •编程│ 分类: 编程                          │
│ •写作│ 帮助审查代码质量和最佳实践          │
│ ⭐收藏│                                     │
└──────┴─────────────────────────────────────┘
```

### 模板编辑

- 标题、分类、标签
- 提示词内容编辑器
- 变量占位符支持 ({{variable}})
- 收藏功能

---

## Token 统计界面

**路由**: `/token-usage`

### 布局

```
Token 使用统计
┌──────────┬──────────┬──────────┬──────────┐
│ 总Token  │ 提示Token│ 完成Token│ 总成本   │
│ 125.4K   │ 65.2K    │ 60.2K    │ ¥25.68   │
└──────────┴──────────┴──────────┴──────────┘

筛选: [全部时间 ▼] [所有模型 ▼]

使用记录
┌────────────────────────────────────────────┐
│ 2025-01-15 14:30                           │
│ 对话: 技术讨论                             │
│ 模型: gpt-4                                │
│ Token: 1,250 (提示: 600, 完成: 650)       │
│ 成本: ¥0.25                                │
└────────────────────────────────────────────┘
```

### 功能

- 总览统计 (Token 总数、成本)
- 时间范围筛选
- 模型筛选
- 详细使用记录列表
- 导出功能

---

## 日志查看界面

**路由**: `/logs`

### 布局

```
系统日志                      [🗑️ 清空] [📤 导出]
筛选: [全部级别 ▼] [搜索...]

┌────────────────────────────────────────────┐
│ ⚠️ 2025-01-15 14:30:25                    │
│ [WARNING] API 请求超时                    │
│ 详情: Connection timeout after 30s        │
└────────────────────────────────────────────┘

┌────────────────────────────────────────────┐
│ ℹ️ 2025-01-15 14:28:10                    │
│ [INFO] 对话创建成功                       │
│ ID: conv_abc123                            │
└────────────────────────────────────────────┘
```

### 功能

- 日志级别筛选 (ALL/INFO/WARNING/ERROR)
- 关键词搜索
- 清空日志
- 导出日志

---

## 对话框和弹窗

### 1. 确认对话框

```
┌─────────────────────────────────────────┐
│  ⚠️ 确认删除                            │
│                                          │
│  确定要删除这条消息吗？                  │
│  此操作无法撤销。                        │
│                                          │
│           [取消]  [确定]                │
└─────────────────────────────────────────┘
```

### 2. 输入对话框

```
┌─────────────────────────────────────────┐
│  ✏️ 重命名对话                          │
│                                          │
│  对话标题:                               │
│  [新的对话标题_____________]            │
│                                          │
│           [取消]  [确定]                │
└─────────────────────────────────────────┘
```

### 3. 标签管理对话框

```
┌─────────────────────────────────────────┐
│  🏷️ 管理标签                            │
│                                          │
│  已选标签:                               │
│  [工作 ×] [重要 ×] [编程 ×]             │
│                                          │
│  可用标签:                               │
│  • 学习  • 生活  • 娱乐                 │
│  • 创意  • 其他                          │
│                                          │
│  [+ 新建标签]       [取消]  [保存]      │
└─────────────────────────────────────────┘
```

### 4. 分组选择对话框

```
┌─────────────────────────────────────────┐
│  📁 移动到分组                           │
│                                          │
│  选择分组:                               │
│  ○ 无分组                                │
│  ○ 🔴 工作项目                          │
│  ○ 🟢 个人学习                          │
│  ○ 🔵 日常对话                          │
│                                          │
│  [+ 新建分组]       [取消]  [确定]      │
└─────────────────────────────────────────┘
```

### 5. 模型配置对话框

```
┌─────────────────────────────────────────┐
│  ⚙️ 模型配置                            │
│                                          │
│  Temperature:  [0.7_______] (0-2)       │
│  控制输出的随机性                        │
│                                          │
│  Max Tokens:   [4096______]             │
│  最大生成长度                            │
│                                          │
│  Top P:        [1.0_______] (0-1)       │
│  核采样参数                              │
│                                          │
│           [重置]  [取消]  [应用]        │
└─────────────────────────────────────────┘
```

### 6. 图片查看器

```
┌─────────────────────────────────────────┐
│  [×]                                     │
│                                          │
│       [        图片显示区域       ]     │
│                                          │
│                                          │
│  [<]  1 / 3  [>]        [💾 保存]      │
└─────────────────────────────────────────┘
```

- 支持左右切换
- 缩放功能
- 保存到本地

### 7. 导出选项对话框

```
┌─────────────────────────────────────────┐
│  📤 导出对话                             │
│                                          │
│  选择格式:                               │
│  ● Markdown (.md)                       │
│  ○ PDF (.pdf)                           │
│  ○ JSON (.json)                         │
│                                          │
│  包含内容:
