# Flutter Chat App - 功能特性文档

## 目录
- [核心功能](#核心功能)
- [用户界面](#用户界面)
- [数据管理](#数据管理)
- [高级功能](#高级功能)
- [技术特性](#技术特性)

---

## 核心功能

### 1. AI 对话

#### 基础对话
- ✅ 支持 OpenAI 格式 API
- ✅ 流式响应（SSE）
- ✅ 多模型切换
- ✅ 对话历史管理
- ✅ 消息编辑/删除/重新生成

#### 模型配置
- ✅ Temperature 控制
- ✅ Max Tokens 设置
- ✅ Top P 调整
- ✅ Frequency Penalty
- ✅ Presence Penalty

#### 多模态输入 🆕
- ✅ 图片上传
- ✅ 多图片选择
- ✅ 图片预览
- ✅ 自动 Base64 转换
- ✅ 支持格式：JPEG, PNG, GIF, WebP

### 2. 会话管理

#### 会话操作
- ✅ 创建新会话
- ✅ 会话重命名
- ✅ 会话删除
- ✅ 会话搜索

#### 会话组织
- ✅ 分组管理
- ✅ 标签系统
- ✅ 收藏功能
- ✅ 排序和筛选

### 3. 系统提示词 (System Prompt)
- ✅ 自定义系统提示词
- ✅ 提示词模板库 🆕
- ✅ 快速应用模板
- ✅ 模板分类管理

---

## 用户界面

### 1. 主题系统

#### 主题模式
- ✅ 亮色主题
- ✅ 暗色主题
- ✅ 跟随系统

#### 主题颜色 🆕
- ✅ 9种预定义配色
  - Indigo (默认)
  - Purple
  - Blue
  - Cyan
  - Teal
  - Green
  - Orange
  - Red
  - Pink
- ✅ 动态颜色切换
- ✅ 持久化配置

### 2. 消息渲染

#### Markdown 支持
- ✅ 基础 Markdown 语法
- ✅ 代码高亮
- ✅ 代码块复制
- ✅ 表格支持
- ✅ LaTeX 数学公式（可选）

#### 消息操作
- ✅ 复制消息
- ✅ 分享消息
- ✅ 编辑消息
- ✅ 删除消息
- ✅ 重新生成

### 3. 响应式布局
- ✅ 桌面端优化
- ✅ 移动端适配
- ✅ 侧边栏折叠
- ✅ 动画过渡

---

## 数据管理

### 1. 本地存储
- ✅ Hive 数据库
- ✅ 会话持久化
- ✅ 设置同步
- ✅ 提示词模板存储 🆕

### 2. 数据导入/导出

#### 导出格式
- ✅ Markdown 格式
- ✅ PDF 格式
- ✅ JSON 格式（备份）

#### 导出选项
- ✅ 单个会话导出
- ✅ 批量导出
- ✅ 包含元数据
- ✅ 自定义文件名

### 3. API 配置
- ✅ 多 API 配置
- ✅ 安全存储（加密）
- ✅ 快速切换
- ✅ 连接测试

---

## 高级功能

### 1. 提示词模板管理 🆕

#### 模板操作
- ✅ 创建模板
- ✅ 编辑模板
- ✅ 删除模板
- ✅ 复制模板

#### 模板组织
- ✅ 分类管理
- ✅ 标签系统
- ✅ 收藏功能
- ✅ 搜索筛选

#### 模板应用
- ✅ 快速插入
- ✅ 预览内容
- ✅ 变量替换（计划中）

### 2. 快捷键系统 🆕

#### 支持的快捷键
- ✅ `Ctrl+N`: 新建对话
- ✅ `Ctrl+F`: 搜索
- ✅ `Ctrl+,`: 打开设置
- ✅ `Ctrl+Enter`: 发送消息
- ✅ `Ctrl+W`: 关闭当前对话

### 3. Token 计数
- ✅ 实时 Token 估算
- ✅ 消息级别统计
- ✅ 会话总计
- ✅ 显示在界面

### 4. 搜索功能
- ✅ 会话搜索
- ✅ 消息内容搜索
- ✅ 实时搜索
- ✅ 高亮显示

---

## 技术特性

### 1. 架构设计

#### 项目结构
```
lib/
├── core/              # 核心功能
│   ├── network/       # 网络层
│   ├── storage/       # 存储层
│   ├── utils/         # 工具类
│   └── constants/     # 常量定义
├── features/          # 功能模块
│   ├── chat/          # 聊天功能
│   ├── settings/      # 设置
│   ├── models/        # 模型管理
│   └── prompts/       # 提示词模板 🆕
└── shared/            # 共享组件
    ├── widgets/       # UI 组件
    └── themes/        # 主题
```

#### 状态管理
- ✅ Riverpod 2.x
- ✅ Provider 模式
- ✅ StateNotifier
- ✅ 依赖注入

### 2. 网络层
- ✅ Dio HTTP 客户端
- ✅ 拦截器
- ✅ 错误处理
- ✅ 重试机制
- ✅ SSE 流式响应

### 3. 数据持久化
- ✅ Hive 本地数据库
- ✅ Flutter Secure Storage (API Keys)
- ✅ JSON 序列化
- ✅ 自动代码生成

### 4. 代码质量

#### 测试
- ✅ 单元测试
- ✅ Widget 测试
- ✅ Mock 对象
- ✅ 测试覆盖率工具

#### 代码规范
- ✅ Dart 分析器
- ✅ Lint 规则
- ✅ 格式化工具
- ✅ 类型安全

---

## 平台支持

### 桌面端
- ✅ macOS
- ✅ Windows
- ✅ Linux

### 移动端
- ✅ iOS
- ✅ Android

### Web 端
- ✅ 现代浏览器
- 🔄 PWA（计划中）

---

## 性能指标

### 应用性能
- ✅ 启动时间: < 2秒
- ✅ 流式响应: 实时显示
- ✅ 滚动性能: 60 FPS
- ✅ 内存占用: 合理范围

### 数据处理
- ✅ 支持长对话
- ✅ 大量消息处理
- ✅ 快速搜索
- ✅ 高效存储

---

## 安全特性

### 数据安全
- ✅ API Key 加密存储
- ✅ 本地数据隔离
- ✅ 无服务器传输（除 API 调用）

### 隐私保护
- ✅ 完全本地存储
- ✅ 无用户追踪
- ✅ 数据导出/删除
- ✅ 开源透明

---

## 未来计划

### Phase 5: 平台优化
- [ ] 窗口管理（最小化到托盘）
- [ ] 原生菜单栏
- [ ] 文件拖放支持
- [ ] 自动更新机制

### Phase 6: MCP 支持
- [ ] MCP 协议集成
- [ ] 上下文同步
- [ ] 服务器配置
- [ ] 调试工具

### Phase 7: Agent 功能
- [ ] 工具/函数调用
- [ ] 插件系统
- [ ] 网络搜索工具
- [ ] 代码执行沙盒

### Phase 8: 性能优化
- [ ] 虚拟滚动
- [ ] 消息分页
- [ ] 缓存优化
- [ ] 启动优化

### Phase 9: 发布准备
- [ ] 应用商店素材
- [ ] 用户文档
- [ ] 发布版本
- [ ] 社区建设

---

## 技术栈

### 核心框架
- Flutter 3.35.6
- Dart 3.9.2

### 主要依赖
- `riverpod: ^2.6.1` - 状态管理
- `go_router: ^14.7.1` - 路由
- `dio: ^5.4.0` - HTTP 客户端
- `hive: ^2.2.3` - 本地数据库
- `flutter_markdown: ^0.7.4+1` - Markdown 渲染
- `share_plus: ^11.1.1` - 分享功能
- `file_picker: ^8.1.6` - 文件选择

### 开发工具
- `build_runner: ^2.4.13` - 代码生成
- `json_serializable: ^6.9.2` - JSON 序列化
- `mockito: ^5.4.4` - 测试 Mock
- `flutter_test` - 测试框架

---

## 贡献指南

查看 [AGENTS.md](../AGENTS.md) 了解：
- 项目结构
- 编码规范
- 提交规范
- 测试要求

---

**最后更新**: 2024-01
**版本**: 开发中
**许可证**: MIT
