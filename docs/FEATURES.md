# Flutter Chat App - 功能特性文档

**版本**: v1.0.0  
**最后更新**: 2024-10-15  

## 目录
- [核心功能](#核心功能)
- [用户界面](#用户界面)
- [数据管理](#数据管理)
- [高级功能](#高级功能)
- [平台支持](#平台支持)
- [性能与安全](#性能与安全)
- [技术栈](#技术栈)

---

## 核心功能

### 1. AI 对话

#### 基础对话
- ✅ 支持 OpenAI 格式 API
- ✅ 流式响应（SSE）
- ✅ 多模型切换
- ✅ 对话历史管理
- ✅ 消息编辑/删除/重新生成
- ✅ 上下文管理（分支对话）
- ✅ 消息搜索功能

#### 模型配置
- ✅ Temperature 控制
- ✅ Max Tokens 设置
- ✅ Top P 调整
- ✅ Frequency Penalty
- ✅ Presence Penalty
- ✅ 模型参数实时调整

#### 多模态输入
- ✅ 图片上传
- ✅ 多图片选择
- ✅ 图片预览
- ✅ 自动 Base64 转换
- ✅ 支持格式：JPEG, PNG, GIF, WebP

#### 工具调用 (MCP)
- ✅ MCP 服务器集成
- ✅ 工具发现和调用
- ✅ 上下文增强
- ✅ 实时状态监控

### 2. 会话管理

#### 会话操作
- ✅ 创建新会话
- ✅ 会话重命名
- ✅ 会话删除
- ✅ 会话搜索
- ✅ 对话置顶
- ✅ 批量操作
- ✅ 对话分组

#### 会话组织
- ✅ 分组管理（8种颜色标识）
- ✅ 标签系统
- ✅ 收藏功能
- ✅ 排序和筛选
- ✅ 多标签筛选
- ✅ 快速访问

### 3. 系统提示词 (System Prompt)
- ✅ 自定义系统提示词
- ✅ 提示词模板库
- ✅ 快速应用模板
- ✅ 模板分类管理
- ✅ 模板标签系统
- ✅ 模板收藏功能
- ✅ 模板导入/导出

---

## 用户界面

### 1. 主题系统

#### 主题模式
- ✅ 亮色主题
- ✅ 暗色主题
- ✅ 跟随系统
- ✅ 自定义背景图片
- ✅ 背景透明度调节

#### 主题颜色
- ✅ 9种预定义配色
  - Indigo (默认)
  - Purple
  - Blue
  - Cyan
  - Teal
  - Green
  - Orange
  - Red
  - Pink
- ✅ 动态颜色切换
- ✅ 持久化配置

### 2. 消息渲染

#### Markdown 支持
- ✅ 基础 Markdown 语法
- ✅ 代码高亮
- ✅ 代码块复制
- ✅ 表格支持
- ✅ LaTeX 数学公式
- ✅ 图片渲染
- ✅ 链接支持

#### 消息操作
- ✅ 复制消息
- ✅ 分享消息
- ✅ 编辑消息
- ✅ 删除消息
- ✅ 重新生成
- ✅ 消息分支

### 3. 响应式布局
- ✅ 桌面端优化（Windows/macOS/Linux）
- ✅ 移动端适配（iOS/Android）
- ✅ iOS 端原生风格 UI 体验
- ✅ 全屏配置页面（替代对话框）
- ✅ 侧边栏折叠
- ✅ 动画过渡
- ✅ 触摸手势优化
- ✅ 自适应键盘
- ✅ 自适应键盘（iOS 点击空白自动隐藏）

---

## 数据管理

### 1. 本地存储
- ✅ Hive 数据库
- ✅ 会话持久化
- ✅ 设置同步
- ✅ 提示词模板存储
- ✅ MCP 配置存储
- ✅ Agent 配置存储
- ✅ Token 使用记录
- ✅ 加密存储 API Key

### 2. 数据导入/导出

#### 导出格式
- ✅ Markdown 格式
- ✅ PDF 格式
- ✅ JSON 格式（备份）

#### 导出选项
- ✅ 单个会话导出
- ✅ 批量导出
- ✅ 包含元数据
- ✅ 自定义文件名
- ✅ 时间戳标记

### 3. API 配置
- ✅ 多 API 配置
- ✅ 提供商类型选择
  - OpenAI
  - Azure OpenAI
  - Ollama
  - Claude
  - 自定义
- ✅ 自定义 Base URL
- ✅ 模型列表管理
- ✅ 默认模型设置
- ✅ 安全存储 API Key

### 4. Token 统计
- ✅ 实时 Token 计数
- ✅ 按会话统计
- ✅ 按模型统计
- ✅ 日期范围筛选
- ✅ 成本分析
- ✅ 详细记录查看
- ✅ 统计数据导出
- ✅ 输入/输出 Token 分开统计

---

## 高级功能

### 1. MCP (Model Context Protocol) 集成

#### 连接模式
- ✅ HTTP 模式
  - RESTful API 通信
  - 自定义请求头
  - 自动心跳检测（30秒间隔）
  - 连接状态监控
- ✅ Stdio 模式
  - JSON-RPC 2.0 协议
  - 进程生命周期管理
  - stderr 日志捕获
  - 请求超时控制（30秒）

#### 功能特性
- ✅ 上下文管理
- ✅ 工具调用
- ✅ 连接状态监控
- ✅ 配置管理界面
- ✅ 实时连接控制
- ✅ 自动重连机制

#### 配置选项
- ✅ 服务器名称
- ✅ 连接类型选择
- ✅ 端点 URL / 命令路径
- ✅ 请求头配置
- ✅ 命令参数
- ✅ 环境变量
- ✅ 服务器描述

### 2. Agent 系统

#### Agent 管理
- ✅ Agent 创建和编辑
- ✅ Agent 启用/禁用
- ✅ Agent 配置管理
- ✅ 系统提示词配置

#### 内置工具
- ✅ 搜索工具
- ✅ 计算器
- ✅ 文件操作
- ✅ 代码执行

#### 工具管理
- ✅ 工具发现
- ✅ 工具参数配置
- ✅ 工具调用历史
- ✅ 自定义工具支持

### 3. 提示词模板系统

#### 模板管理
- ✅ 模板创建和编辑
- ✅ 模板删除
- ✅ 模板复制
- ✅ 模板搜索

#### 模板组织
- ✅ 分类管理
- ✅ 标签系统
- ✅ 收藏功能
- ✅ 分类筛选
- ✅ 标签筛选

#### 模板使用
- ✅ 快速应用到对话
- ✅ 变量替换
- ✅ 模板预览
- ✅ 使用次数统计

---

## 平台支持

### 桌面平台
- ✅ macOS（完全支持，macOS 11.0+）
  - 原生窗口管理
  - 菜单栏集成
  - 触控板手势
- ✅ Windows（基础支持）
  - 窗口管理
  - 系统托盘
- ✅ Linux（基础支持）
  - 窗口管理

### 移动平台
- ✅ iOS（完全支持，iOS 13.0+）
  - 原生风格 UI
  - 触摸手势优化
  - 键盘自动管理
  - 系统分享集成
- ✅ Android（完全支持，API 21+）
  - Material Design
  - 系统分享集成
  - 文件访问权限

### Web 平台
- ✅ 现代浏览器（Chrome, Firefox, Safari, Edge）
- ✅ 响应式设计
- ✅ PWA 支持

---

## 性能与安全

### 性能指标
- ✅ 启动时间: < 2秒
- ✅ 流式响应: 实时显示
- ✅ 滚动性能: 60 FPS
- ✅ 内存占用: 合理范围
- ✅ 支持长对话（1000+ 消息）
- ✅ 快速搜索（< 100ms）

### 安全特性
- ✅ API Key 加密存储
- ✅ 本地数据隔离
- ✅ 无服务器传输（除 API 调用）
- ✅ 完全本地存储
- ✅ 无用户追踪
- ✅ 数据导出/删除
- ✅ 开源透明

---

## 技术栈

### 核心框架
- Flutter 3.8.0+
- Dart 3.8.0+

### 状态管理
- `flutter_riverpod: ^3.0.3` - 状态管理
- `riverpod_annotation: ^3.0.3` - Riverpod 注解

### 网络与存储
- `dio: ^5.4.0` - HTTP 客户端
- `hive: ^2.2.3` - 本地数据库
- `flutter_secure_storage: ^10.0.0` - 安全存储
- `path_provider: ^2.1.2` - 文件路径

### UI 组件
- `go_router: ^16.2.4` - 路由管理
- `flutter_markdown: ^0.7.7+1` - Markdown 渲染
- `flutter_highlight: ^0.7.0` - 代码高亮
- `flutter_math_fork: ^0.7.4` - LaTeX 公式

### 平台特定
- `window_manager: ^0.5.1` - 窗口管理
- `tray_manager: ^0.5.1` - 系统托盘
- `file_picker: ^10.3.3` - 文件选择
- `share_plus: ^12.0.0` - 分享功能

### 工具库
- `uuid: ^4.3.3` - UUID 生成
- `intl: ^0.20.2` - 国际化
- `pdf: ^3.11.3` - PDF 生成
- `logger: ^2.0.2+1` - 日志记录
- `expressions: ^0.2.5+3` - 表达式计算

### 开发工具
- `build_runner: ^2.4.13` - 代码生成
- `json_serializable: ^6.11.1` - JSON 序列化
- `riverpod_generator: ^3.0.3` - Riverpod 生成器
- `mockito: ^5.4.4` - 测试 Mock
- `flutter_lints: ^6.0.0` - 代码规范

---

## 开发路线图

### Phase 8: 性能优化（部分完成）
- [✓] 消息滚动优化
- [ ] 图片缓存优化
- [✓] 启动速度优化
- [✓] iOS 键盘体验优化
- [✓] 布局响应性优化

### Phase 9: 发布准备（进行中）
- [✓] 完善用户文档
- [✓] GitHub Actions CI/CD
- [ ] 应用商店素材准备
- [ ] iOS App Store 发布
- [ ] Google Play Store 发布
- [ ] Desktop 安装包制作
- [ ] Web 版本部署

### 未来计划
- [ ] 语音输入支持
- [ ] 语音输出（TTS）
- [ ] 插件系统
- [ ] 云同步功能
- [ ] 协作功能
- [ ] 更多 AI 模型支持

---

## 贡献指南

查看 [AGENTS.md](../AGENTS.md) 了解：
- 项目结构
- 编码规范
- 提交规范
- 测试要求
- 开发环境配置

---

**版本**: v1.0.0  
**许可证**: MIT  
**文档**: [docs/README.md](README.md)
