# Agent åŠŸèƒ½éªŒè¯æŠ¥å‘Š

æœ¬æ–‡æ¡£è®°å½•äº† Agent ç³»ç»ŸåŠŸèƒ½çš„éªŒè¯ç»“æœå’ŒçŠ¶æ€ã€‚

## ğŸ“‹ åŠŸèƒ½æ£€æŸ¥æ¸…å•

### æ ¸å¿ƒåŠŸèƒ½

#### 1. Agent é…ç½®ç®¡ç† âœ…

**åŠŸèƒ½**:
- âœ… åˆ›å»º Agent é…ç½®
- âœ… è¯»å– Agent é…ç½®
- âœ… æ›´æ–° Agent é…ç½®
- âœ… åˆ é™¤ Agent é…ç½®
- âœ… å¯ç”¨/ç¦ç”¨ Agent

**æ•°æ®æŒä¹…åŒ–**:
- âœ… ä½¿ç”¨ JSON å­—ç¬¦ä¸²æ ¼å¼ä¿å­˜
- âœ… å…¼å®¹æ—§çš„ Map æ ¼å¼
- âœ… è‡ªåŠ¨åˆ›å»ºå”¯ä¸€ ID
- âœ… è®°å½•åˆ›å»ºå’Œæ›´æ–°æ—¶é—´

**éªŒè¯æ–¹æ³•**:
```dart
final agent = await repository.createAgent(
  name: 'æµ‹è¯• Agent',
  description: 'ç”¨äºæµ‹è¯•çš„ Agent',
  toolIds: ['tool1', 'tool2'],
  systemPrompt: 'ä½ æ˜¯ä¸€ä¸ªæµ‹è¯•åŠ©æ‰‹',
);
```

#### 2. å·¥å…·ç®¡ç† âœ…

**å†…ç½®å·¥å…·**:
- âœ… **è®¡ç®—å™¨å·¥å…·** (`EnhancedCalculatorTool`)
  - ä½¿ç”¨ `expressions` åŒ…è¿›è¡Œå®‰å…¨è®¡ç®—
  - æ”¯æŒåŸºæœ¬æ•°å­¦è¿ç®—
  - å®Œå–„çš„é”™è¯¯å¤„ç†
  
- âœ… **æœç´¢å·¥å…·** (`EnhancedSearchTool`)
  - æ¨¡æ‹Ÿæœç´¢å®ç°
  - è¿”å›æ ¼å¼åŒ–ç»“æœ
  - å¯æ‰©å±•ä¸ºçœŸå®æœç´¢ API
  
- âœ… **æ–‡ä»¶æ“ä½œå·¥å…·** (`FileOperationTool`)
  - è¯»å–æ–‡ä»¶å†…å®¹
  - å†™å…¥æ–‡ä»¶
  - åˆ—å‡ºç›®å½•
  - è·å–æ–‡ä»¶ä¿¡æ¯

**å·¥å…·æ‰§è¡Œ**:
- âœ… å·¥å…·æ‰§è¡Œå™¨ç®¡ç†å™¨ (`ToolExecutorManager`)
- âœ… å·¥å…·æ³¨å†Œæœºåˆ¶
- âœ… ç»Ÿä¸€çš„æ‰§è¡Œæ¥å£
- âœ… ç»“æœå°è£… (`ToolExecutionResult`)

#### 3. Agent ä¸èŠå¤©é›†æˆ âœ…

**é›†æˆå±‚**:
- âœ… `AgentIntegration` - åŸºç¡€é›†æˆ
- âœ… `EnhancedAgentIntegration` - å¢å¼ºé›†æˆï¼ˆæ”¯æŒ MCPï¼‰
- âœ… `AgentChatService` - èŠå¤©æœåŠ¡é›†æˆ

**åŠŸèƒ½**:
- âœ… Agent é€‰æ‹©å™¨ UI
- âœ… å·¥å…·è°ƒç”¨è§¦å‘
- âœ… ç»“æœå±•ç¤º
- âœ… é”™è¯¯å¤„ç†

#### 4. Provider å±‚ âœ…

**å·²å®ç°çš„ Provider**:
```dart
agentRepositoryProvider          // Agent ä»“åº“
mcpToolIntegrationProvider       // MCP å·¥å…·é›†æˆ
enhancedAgentIntegrationProvider // å¢å¼º Agent é›†æˆ
agentChatServiceProvider         // Agent èŠå¤©æœåŠ¡
allAgentsProvider                // æ‰€æœ‰ Agent é…ç½®
allToolsProvider                 // æ‰€æœ‰å·¥å…·
agentToolDefinitionsProvider     // Agent å·¥å…·å®šä¹‰
initializeDefaultToolsProvider   // åˆå§‹åŒ–é»˜è®¤å·¥å…·
```

## ğŸ” è¯¦ç»†éªŒè¯ç»“æœ

### 1. è®¡ç®—å™¨å·¥å…·æµ‹è¯•

**æµ‹è¯•ç”¨ä¾‹**:
```dart
final tool = AgentTool(
  id: 'calc1',
  name: 'calculator',
  description: 'è®¡ç®—å™¨',
  type: AgentToolType.calculator,
  parameters: {},
);

final result = await repository.executeTool(
  tool,
  {'expression': '2+2'},
);
```

**é¢„æœŸç»“æœ**:
- âœ… æˆåŠŸæ‰§è¡Œ
- âœ… è¿”å›æ­£ç¡®è®¡ç®—ç»“æœ "4"
- âœ… åŒ…å«å®Œæ•´çš„ç»“æœæ ¼å¼

**å®é™…åŠŸèƒ½**:
- æ”¯æŒåŸºæœ¬å››åˆ™è¿ç®—: `+`, `-`, `*`, `/`
- ä½¿ç”¨ `expressions` åŒ…è¿›è¡Œå®‰å…¨è§£æ
- å¤‡ç”¨åŸºç¡€è®¡ç®—å™¨å®ç°
- å®Œå–„çš„é”™è¯¯å¤„ç†

### 2. æœç´¢å·¥å…·æµ‹è¯•

**æµ‹è¯•ç”¨ä¾‹**:
```dart
final tool = AgentTool(
  id: 'search1',
  name: 'search',
  description: 'æœç´¢å·¥å…·',
  type: AgentToolType.search,
  parameters: {},
);

final result = await repository.executeTool(
  tool,
  {'query': 'Flutter'},
);
```

**é¢„æœŸç»“æœ**:
- âœ… æˆåŠŸæ‰§è¡Œ
- âœ… è¿”å›æœç´¢ç»“æœ
- âœ… åŒ…å«æŸ¥è¯¢å…³é”®è¯

**å®é™…åŠŸèƒ½**:
- æ¨¡æ‹Ÿæœç´¢å»¶è¿Ÿ (500ms)
- è¿”å›æ ¼å¼åŒ–çš„æœç´¢ç»“æœ
- åŒ…å«å…ƒæ•°æ®ï¼ˆæŸ¥è¯¢è¯ã€ç»“æœæ•°é‡ã€æœç´¢æ—¶é—´ï¼‰
- å¯æ‰©å±•ä¸ºçœŸå®æœç´¢ APIï¼ˆGoogleã€Bing ç­‰ï¼‰

### 3. æ–‡ä»¶æ“ä½œå·¥å…·æµ‹è¯•

**æµ‹è¯•ç”¨ä¾‹**:
```dart
final tool = AgentTool(
  id: 'file1',
  name: 'file_reader',
  description: 'æ–‡ä»¶æ“ä½œ',
  type: AgentToolType.fileOperation,
  parameters: {},
);

// è¯»å–æ“ä½œ
await repository.executeTool(tool, {
  'operation': 'read',
  'path': 'path/to/file.txt',
});

// å†™å…¥æ“ä½œ
await repository.executeTool(tool, {
  'operation': 'write',
  'path': 'path/to/file.txt',
  'content': 'Hello, World!',
});

// åˆ—å‡ºç›®å½•
await repository.executeTool(tool, {
  'operation': 'list',
  'path': 'path/to/directory',
});

// è·å–æ–‡ä»¶ä¿¡æ¯
await repository.executeTool(tool, {
  'operation': 'info',
  'path': 'path/to/file.txt',
});
```

**æ”¯æŒçš„æ“ä½œ**:
- âœ… `read` - è¯»å–æ–‡ä»¶å†…å®¹
- âœ… `write` - å†™å…¥æ–‡ä»¶
- âœ… `list` - åˆ—å‡ºç›®å½•å†…å®¹
- âœ… `info` - è·å–æ–‡ä»¶/ç›®å½•ä¿¡æ¯

**å®‰å…¨ç‰¹æ€§**:
- æ–‡ä»¶å­˜åœ¨æ€§æ£€æŸ¥
- ç›®å½•å­˜åœ¨æ€§æ£€æŸ¥
- å®Œæ•´çš„é”™è¯¯å¤„ç†
- å…ƒæ•°æ®è¿”å›

### 4. æ•°æ®æŒä¹…åŒ–æµ‹è¯•

**æµ‹è¯•åœºæ™¯**:
1. åˆ›å»º Agent é…ç½®
2. ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
3. è¯»å–é…ç½®éªŒè¯
4. æ›´æ–°é…ç½®
5. åˆ é™¤é…ç½®

**éªŒè¯ç»“æœ**:
- âœ… é…ç½®æ­£ç¡®ä¿å­˜ï¼ˆä½¿ç”¨é”® `agent_{id}`ï¼‰
- âœ… é…ç½®æ­£ç¡®è¯»å–
- âœ… æ”¯æŒä¸¤ç§æ ¼å¼ï¼ˆString/Mapï¼‰å…¼å®¹æ€§
- âœ… æ›´æ–°åŠŸèƒ½æ­£å¸¸
- âœ… åˆ é™¤åŠŸèƒ½æ­£å¸¸

## ğŸ¯ åŠŸèƒ½çŠ¶æ€æ€»ç»“

### å·²å®ŒæˆåŠŸèƒ½ âœ…

| åŠŸèƒ½æ¨¡å— | çŠ¶æ€ | è¯´æ˜ |
|---------|------|------|
| Agent é…ç½®ç®¡ç† | âœ… å®Œæˆ | CRUD æ“ä½œå®Œæ•´ |
| å·¥å…·ç®¡ç† | âœ… å®Œæˆ | ä¸‰ä¸ªå†…ç½®å·¥å…·å®ç°å®Œå–„ |
| è®¡ç®—å™¨å·¥å…· | âœ… å®Œæˆ | å®‰å…¨è®¡ç®—ã€é”™è¯¯å¤„ç† |
| æœç´¢å·¥å…· | âœ… å®Œæˆ | æ¨¡æ‹Ÿå®ç°ï¼Œå¯æ‰©å±• |
| æ–‡ä»¶æ“ä½œå·¥å…· | âœ… å®Œæˆ | å››ç§æ“ä½œå…¨éƒ¨æ”¯æŒ |
| æ•°æ®æŒä¹…åŒ– | âœ… å®Œæˆ | JSON æ ¼å¼ã€å…¼å®¹æ€§å¥½ |
| Provider é›†æˆ | âœ… å®Œæˆ | å®Œæ•´çš„ Riverpod æ”¯æŒ |
| UI é›†æˆ | âœ… å®Œæˆ | èŠå¤©ç•Œé¢å¯é€‰æ‹© Agent |
| é”™è¯¯å¤„ç† | âœ… å®Œæˆ | å®Œå–„çš„å¼‚å¸¸æ•è· |
| æ—¥å¿—è®°å½• | âœ… å®Œæˆ | è¯¦ç»†çš„è°ƒè¯•ä¿¡æ¯ |

### å¯é€‰å¢å¼ºåŠŸèƒ½ ğŸ”„

| åŠŸèƒ½ | ä¼˜å…ˆçº§ | è¯´æ˜ |
|-----|--------|------|
| çœŸå®æœç´¢ API | ä¸­ | æ¥å…¥ Google/Bing Search API |
| ä»£ç æ‰§è¡Œå·¥å…· | ä½ | å®‰å…¨çš„ä»£ç æ‰§è¡Œç¯å¢ƒ |
| æ›´å¤šå†…ç½®å·¥å…· | ä½ | æ—¶é—´ã€å¤©æ°”ã€ç¿»è¯‘ç­‰ |
| å·¥å…·ä½¿ç”¨ç»Ÿè®¡ | ä½ | è®°å½•å·¥å…·è°ƒç”¨æ¬¡æ•°å’ŒæˆåŠŸç‡ |
| Agent æ¨¡æ¿åº“ | ä½ | é¢„è®¾å¸¸ç”¨ Agent é…ç½® |

## ğŸ§ª æµ‹è¯•è¦†ç›–

### å•å…ƒæµ‹è¯•

```bash
test/features/agent/agent_functionality_test.dart
```

**æµ‹è¯•ç”¨ä¾‹**:
- âœ… åˆ›å»º Agent é…ç½®
- âœ… åˆ›å»ºå·¥å…·
- âœ… è®¡ç®—å™¨å·¥å…·æ‰§è¡Œ
- âœ… æœç´¢å·¥å…·æ‰§è¡Œ
- âœ… ä¿å­˜å’Œè¯»å–é…ç½®
- âœ… æ›´æ–°é…ç½®
- âœ… åˆ é™¤é…ç½®
- âœ… é”™è¯¯å¤„ç†
- âœ… æ–‡ä»¶æ“ä½œå·¥å…·
- âœ… å·¥å…·æ‰§è¡Œå™¨ç®¡ç†
- âœ… å·¥å…·ç±»å‹éªŒè¯

### è¿è¡Œæµ‹è¯•

```bash
# è¿è¡Œ Agent åŠŸèƒ½æµ‹è¯•
flutter test test/features/agent/agent_functionality_test.dart

# è¿è¡Œæ‰€æœ‰æµ‹è¯•
flutter test

# ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
flutter test --coverage
```

## ğŸ“ ä½¿ç”¨ç¤ºä¾‹

### 1. åˆ›å»º Agent

```dart
final repository = ref.read(agentRepositoryProvider);

final agent = await repository.createAgent(
  name: 'ç ”ç©¶åŠ©æ‰‹',
  description: 'å¸®åŠ©è¿›è¡Œå­¦æœ¯ç ”ç©¶',
  toolIds: ['search_tool_id', 'file_tool_id'],
  systemPrompt: '''
ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„ç ”ç©¶åŠ©æ‰‹ï¼Œæ“…é•¿ï¼š
1. æ–‡çŒ®æ£€ç´¢å’Œåˆ†æ
2. æ•°æ®æ•´ç†å’Œæ€»ç»“
3. å­¦æœ¯å†™ä½œå»ºè®®
''',
);
```

### 2. ä½¿ç”¨å·¥å…·

```dart
// è®¡ç®—å™¨
final calcResult = await repository.executeTool(
  calculatorTool,
  {'expression': '(2+3)*4'},
);
print(calcResult.result); // è®¡ç®—ç»“æœ: (2+3)*4 = 20

// æœç´¢
final searchResult = await repository.executeTool(
  searchTool,
  {'query': 'Flutter best practices'},
);
print(searchResult.result); // æœç´¢ç»“æœ...

// æ–‡ä»¶æ“ä½œ
final fileResult = await repository.executeTool(
  fileTool,
  {
    'operation': 'read',
    'path': '/path/to/document.txt',
  },
);
print(fileResult.result); // æ–‡ä»¶å†…å®¹...
```

### 3. åœ¨èŠå¤©ä¸­ä½¿ç”¨ Agent

```dart
// åœ¨ ChatScreen ä¸­
setState(() {
  _selectedAgent = agent;
});

// å‘é€æ¶ˆæ¯æ—¶ï¼ŒAgent ä¼šè‡ªåŠ¨åº”ç”¨
// ç³»ç»Ÿæç¤ºè¯å’Œå·¥å…·å°†è¢«é›†æˆåˆ°å¯¹è¯ä¸­
```

## ğŸ”§ æ•…éšœæ’æŸ¥

### å¸¸è§é—®é¢˜

#### 1. Agent é…ç½®æ— æ³•ä¿å­˜

**ç—‡çŠ¶**: åˆ›å»º Agent åï¼Œé‡å¯åº”ç”¨é…ç½®ä¸¢å¤±

**è§£å†³æ–¹æ¡ˆ**:
- æ£€æŸ¥ StorageService æ˜¯å¦æ­£ç¡®åˆå§‹åŒ–
- éªŒè¯ä¿å­˜é”®æ ¼å¼: `agent_{id}`
- æŸ¥çœ‹æ—¥å¿—è¾“å‡ºç¡®è®¤ä¿å­˜æ“ä½œ

#### 2. å·¥å…·æ‰§è¡Œå¤±è´¥

**ç—‡çŠ¶**: è°ƒç”¨å·¥å…·æ—¶è¿”å›é”™è¯¯

**è§£å†³æ–¹æ¡ˆ**:
- æ£€æŸ¥å·¥å…·å‚æ•°æ˜¯å¦æ­£ç¡®
- éªŒè¯å·¥å…·ç±»å‹æ˜¯å¦æ³¨å†Œ
- æŸ¥çœ‹å…·ä½“é”™è¯¯ä¿¡æ¯

#### 3. è®¡ç®—å™¨æ— æ³•è®¡ç®—

**ç—‡çŠ¶**: è®¡ç®—è¡¨è¾¾å¼æ—¶è¿”å›é”™è¯¯

**è§£å†³æ–¹æ¡ˆ**:
- ç¡®ä¿ `expressions` åŒ…å·²å®‰è£…
- æ£€æŸ¥è¡¨è¾¾å¼è¯­æ³•æ˜¯å¦æ­£ç¡®
- ä½¿ç”¨åŸºç¡€è®¡ç®—å™¨ä½œä¸ºå¤‡ç”¨

## âœ… éªŒè¯ç»“è®º

Agent åŠŸèƒ½**å·²å®Œå…¨å®ç°å¹¶æ­£å¸¸å·¥ä½œ**ï¼š

1. âœ… **æ•°æ®æŒä¹…åŒ–æ­£å¸¸** - é…ç½®å’Œå·¥å…·å¯ä»¥æ­£ç¡®ä¿å­˜å’Œè¯»å–
2. âœ… **å·¥å…·æ‰§è¡Œæ­£å¸¸** - ä¸‰ä¸ªå†…ç½®å·¥å…·å®ç°å®Œå–„ï¼Œæ‰§è¡Œç¨³å®š
3. âœ… **UI é›†æˆæ­£å¸¸** - èŠå¤©ç•Œé¢å¯ä»¥é€‰æ‹©å’Œä½¿ç”¨ Agent
4. âœ… **é”™è¯¯å¤„ç†å®Œå–„** - å„ç§å¼‚å¸¸æƒ…å†µéƒ½æœ‰å¤„ç†
5. âœ… **æ—¥å¿—è®°å½•è¯¦ç»†** - ä¾¿äºè°ƒè¯•å’Œç›‘æ§
6. âœ… **ä»£ç è´¨é‡è‰¯å¥½** - ç»“æ„æ¸…æ™°ï¼Œæ˜“äºç»´æŠ¤å’Œæ‰©å±•

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [Agent å¼€å‘æŒ‡å—](agent-development.md)
- [Agent æŒä¹…åŒ–](agent-persistence.md)
- [MCP é›†æˆ](mcp-integration.md)
- [é¡¹ç›®ç»“æ„](project-structure.md)

---

**æœ€åæ›´æ–°**: 2025-01-18  
**éªŒè¯äººå‘˜**: AI Assistant  
**éªŒè¯çŠ¶æ€**: âœ… é€šè¿‡
