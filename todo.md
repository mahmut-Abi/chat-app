# Flutter Chat App - 项目任务清单

> 类似 Cherry Studio 的跨平台 AI 聊天应用
> 支持平台:Web、Desktop(Windows/macOS/Linux)、Mobile(iOS/Android)

## 🎯 项目目标

- 创建一个现代化的 AI 聊天界面
- 支持 OpenAI 格式的 API 接口
- 跨平台支持(Web/Desktop/Mobile)
- 后期扩展 MCP(Model Context Protocol)和 Agent 功能

---

## 🆕 最新更新

### 最新完成功能 (2025-10-12)



---

## 💡 使用说明

#

---

## 🆕 最新更新

### 最新完成功能 (2025-10-12)

#### 消息分享功能
- ✅ 在消息气泡中添加分享按钮
- ✅ 使用 share_plus 实现跨平台分享
- ✅ 支持分享单条消息内容

#### 设置页面增强
- ✅ 字体大小调节滑块 (12-20pt)
- ✅ Markdown 渲染开关
- ✅ 代码高亮开关
- ✅ LaTeX 数学公式开关
- ✅ HTTP 代理配置界面

#### LaTeX 数学公式支持
- ✅ 使用 flutter_math_fork 渲染数学公式
- ✅ 支持行内公式 ($...$) 和块级公式 ($$...$$)
- ✅ 可通过设置页面开关启用/禁用
- ✅ 集成到 EnhancedMarkdownMessage 组件

#### 快捷键支持框架
- ✅ 创建快捷键配置文件 (lib/core/utils/shortcuts.dart)
- ✅ 定义核心快捷键:
  - Ctrl+N: 新建对话
  - Ctrl+F: 搜索
  - Ctrl+,: 设置
  - Ctrl+Enter: 发送消息
  - Ctrl+W: 关闭当前对话

#### CI/CD 完善
- ✅ GitHub Actions 工作流配置
- ✅ 多平台测试和构建支持
- ✅ 代码质量检查自动化
- ✅ 测试覆盖率上传 Codecov

#### 依赖包更新
- ✅ Riverpod 2.6.1 → 3.0.3
- ✅ Freezed 2.5.2 → 3.2.3
- ✅ 其他核心依赖包升级到最新兼容版本
- ✅ SDK 版本约束更新: >=3.8.0

---

## 💡 使用说明

### 运行应用
```bash
# Web 平台
flutter run -d chrome

# macOS 平台
brew install cocoapods
flutter run -d macos

# iOS 平台
flutter run -d ios

# Android 平台
flutter run -d android
```

### 配置 API
1. 启动应用后点击右上角设置图标
2. 点击"添加 API 配置"
3. 输入配置信息:
   - 配置名称: 如 "OpenAI"
   - 提供商: 选择提供商类型
   - Base URL: API 基础地址
   - API Key: 你的 API 密钥
4. 保存配置

### 开始聊天
1. 返回主页面
2. 点击"新建对话"
3. 在聊天界面可以:
   - 点击右上角齿轮图标配置模型参数
   - 输入消息并发送
   - 长按消息进行编辑/删除/重新生成
   - 复制消息内容
   - 使用分组和标签组织对话

### 数据管理
1. 进入设置页面
2. 在"数据管理"部分可以:
   - 导出所有对话和配置（JSON/Markdown/PDF）
   - 导入备份数据
   - 清除所有数据

### 高级功能使用

**1. 会话分组**:
- 点击侧边栏顶部的文件夹图标
- 创建分组并选择颜色
- 将对话拖放到分组中

**2. 标签系统**:
- 右键点击对话项
- 选择"管理标签"
- 添加或删除标签

**3. 模型配置**:
- 在聊天界面点击右上角调节图标
- 配置 Temperature、Max Tokens 等参数
- 设置系统提示词

**4. Token 计数**:
- 在消息输入框下方查看实时 token 估算

5. **对话置顶**:
   - 右键点击对话项，选择"置顶/取消置顶"
   - 置顶的对话会始终显示在列表顶部

6. **消息搜索**:
   - 在聊天界面点击搜索图标
   - 输入关键词快速定位到相关消息
   - 支持全文搜索，大小写不敏感

### 最新完成功能 (2025-10-12)

#### 消息分享功能
- ✅ 在消息气泡中添加分享按钮
- ✅ 使用 share_plus 实现跨平台分享
- ✅ 支持分享单条消息内容

#### 设置页面增强
- ✅ 字体大小调节滑块 (12-20pt)
- ✅ Markdown 渲染开关
- ✅ 代码高亮开关
- ✅ LaTeX 数学公式开关
- ✅ HTTP 代理配置界面

#### LaTeX 数学公式支持
- ✅ 使用 flutter_math_fork 渲染数学公式
- ✅ 支持行内公式 ($...$) 和块级公式 ($$...$$)
- ✅ 可通过设置页面开关启用/禁用
- ✅ 集成到 EnhancedMarkdownMessage 组件

#### 快捷键支持框架
- ✅ 创建快捷键配置文件 (lib/core/utils/shortcuts.dart)
- ✅ 定义核心快捷键:
  - Ctrl+N: 新建对话
  - Ctrl+F: 搜索
  - Ctrl+,: 设置
  - Ctrl+Enter: 发送消息
  - Ctrl+W: 关闭当前对话

#### CI/CD 完善
- ✅ GitHub Actions 工作流配置
- ✅ 多平台测试和构建支持
- ✅ 代码质量检查自动化
- ✅ 测试覆盖率上传 Codecov

#### 依赖包更新
- ✅ Riverpod 2.6.1 → 3.0.3
- ✅ Freezed 2.5.2 → 3.2.3
- ✅ 其他核心依赖包升级到最新兼容版本
- ✅ SDK 版本约束更新: >=3.8.0

---

## 📋 Phase 1: 项目初始化与基础架构 ✅

### 1.1 项目搭建
- [x] 初始化 Flutter 项目,配置多平台支持
- [x] 配置项目结构(features/shared/core 架构)
- [x] 添加必要的依赖包
  - [x] `dio` - HTTP 请求
  - [x] `riverpod` - 状态管理
  - [x] `hive` - 本地数据库
  - [x] `go_router` - 路由管理
  - [x] `freezed` - 数据类生成
  - [x] `json_serializable` - JSON 序列化
- [x] 配置代码生成工具(build_runner)
- [x] 设置 lint 规则和代码格式化

### 1.2 项目结构设计
- [x] 创建基础目录结构
- [x] 设置环境配置(开发/生产)

---

## 📋 Phase 2: 核心功能开发 ✅

### 2.1 OpenAI API 集成
- [x] 创建 API 客户端基类
- [x] 实现 OpenAI 格式 API 接口
  - [x] Chat Completions API
  - [x] Streaming 支持(SSE)
  - [x] Token 计数
  - [x] 错误处理和重试机制
- [x] 支持自定义 API 端点和 API Key
- [x] 实现多个 API 提供商配置

### 2.2 数据模型设计
- [x] 定义核心数据模型
- [x] 使用 Freezed 生成不可变数据类
- [x] 实现 JSON 序列化/反序列化

### 2.3 本地存储
- [x] 设置 Hive 数据库
- [x] 实现会话历史存储
- [x] 实现 API 配置持久化
- [x] 实现用户偏好设置存储
- [x] 添加数据导入/导出功能

---

## 📋 Phase 3: 用户界面开发 ✅

### 3.1 主界面布局
- [x] 设计响应式布局(适配不同屏幕尺寸)
- [x] 实现侧边栏(会话列表)
- [x] 实现主聊天区域
- [x] 实现设置面板

### 3.2 聊天功能
- [x] 消息渲染(Markdown、代码高亮、LaTeX)
- [x] 实时流式响应显示
- [x] 消息编辑/删除/重新生成
- [x] 消息复制/分享
- [x] 支持多模态输入(图片上传)

### 3.3 主题与样式
- [x] 实现亮色/暗色主题切换
- [x] 设计现代化 UI
- [x] 添加平滑动画和过渡效果
- [x] 自定义主题颜色配置

---

## 📋 Phase 4: 高级功能 ✅

### 4.1 模型管理
- [x] 模型列表获取(通过 API)
- [x] 模型切换功能
- [x] 模型参数配置界面
- [x] 预设模板管理(System Prompt)

### 4.2 多会话管理
- [x] 支持多个会话同时存在
- [x] 会话间快速切换
- [x] 会话历史浏览
- [x] 会话导出(Markdown/PDF/JSON)

### 4.3 设置页面
- [x] API 配置管理
- [x] 通用设置
- [x] 快捷键配置(桌面端)

### 4.4 提示词模板管理
- [x] 模板创建和编辑
- [x] 模板分类管理
- [x] 收藏和标签功能
- [x] 模板搜索和筛选

---

## 📋 Phase 5: 平台特定优化 ✅

### 5.1 桌面端(Windows/macOS/Linux)
- [x] 窗口管理(最小化到托盘)
- [x] 系统托盘支持
- [x] 桌面服务管理
- [x] 快捷键支持
- [x] 文件拖放支持
- [x] 原生菜单栏基础架构
- [ ] 自动更新机制(可选)

### 5.2 移动端(iOS/Android)
- [x] 触摸手势优化
- [x] 移动端布局适配
- [ ] 分享扩展(iOS)/ Share Intent(Android)
- [ ] 键盘处理优化

### 5.3 Web 端
- [x] PWA 支持(Service Worker)
- [x] PWA 服务管理
- [x] 响应式设计优化
- [ ] URL 路由和深链接
- [ ] 浏览器存储优化

---

## 📋 Phase 6: MCP(Model Context Protocol)支持 ✅

### 6.1 MCP 基础实现
- [x] 设计 MCP 客户端架构
- [x] 实现 MCP 连接管理
- [x] 实现上下文同步机制
- [x] 心跳检测机制

### 6.2 MCP 功能集成
- [x] MCP 配置管理(CRUD)
- [x] MCP 服务器配置界面
- [x] 连接状态管理和显示
- [x] 与聊天功能集成类
- [x] 上下文提供者管理
- [ ] 调试和日志工具

---

## 📋 Phase 7: Agent 功能支持 ✅

### 7.1 Agent 架构设计
- [x] 设计 Agent 系统架构
- [x] 实现工具/函数调用机制
- [x] 创建插件系统基础框架
- [x] Agent 与聊天功能集成

### 7.2 内置 Agent 工具
- [x] 网络搜索工具
- [x] 计算器工具(增强版)
- [x] 文件操作工具(读写、列表、信息)
- [ ] 代码执行工具(沙盒环境)

### 7.3 自定义 Agent
- [x] Agent 创建界面
- [x] 工具配置和管理
- [x] 工具管理界面
- [ ] Agent 模板库
- [ ] Agent 执行流程可视化

---

## 📋 Phase 8: 测试与优化 🔄

### 8.1 单元测试
- [x] API 客户端测试
- [x] 数据模型测试
- [x] Agent Repository 测试
- [x] MCP Repository 测试
- [x] Tool Executor 测试
- [x] 业务逻辑测试
- [x] 存储层测试

### 8.2 集成测试
- [ ] 端到端流程测试
- [ ] 多平台兼容性测试

### 8.3 性能优化
- [x] 虚拟滚动列表实现
- [x] 性能监控工具
- [x] 缓存机制
- [x] 防抖和节流工具
- [ ] 内存使用优化
- [ ] 网络请求优化(并发控制)
- [ ] 应用启动速度优化

### 8.4 用户体验优化
- [x] 加载状态组件
- [x] 错误状态组件
- [x] 空状态组件
- [x] 骨架屏组件
- [ ] 离线功能支持
- [ ] 无障碍功能(Accessibility)

---

## 📋 Phase 9: 文档与发布 🔄

### 9.1 文档编写
- [x] AGENTS.md - 项目开发规范
- [x] Git Hooks 使用指南
- [x] 项目进度总结文档
- [x] Docker 部署文档
- [x] 平台支持文档
- [ ] 用户使用文档
- [ ] API 集成指南
- [ ] 开发者文档
- [ ] README 优化

### 9.2 应用发布
- [ ] 准备应用商店素材(截图、描述)
- [ ] iOS App Store 发布
- [ ] Google Play Store 发布
- [ ] Windows/macOS/Linux 安装包
- [ ] Web 版本部署

### 9.3 持续维护
- [x] Git Hooks 代码质量检查
- [x] CI/CD 流程配置
- [ ] 用户反馈收集机制
- [ ] Bug 追踪系统
- [ ] 版本更新计划
- [ ] 社区建设

---

## 🔧 技术栈

### 核心依赖
- **状态管理**: Riverpod 2.x ✅
- **路由**: go_router ✅
- **网络**: dio + retrofit ✅
- **数据库**: hive ✅
- **代码生成**: freezed + json_serializable + build_runner ✅

### UI 组件
- **Markdown**: flutter_markdown ✅
- **代码高亮**: flutter_highlight ✅
- **图标**: flutter_svg ✅
- **动画**: animations package ✅

### 平台特定
- **桌面**: window_manager, tray_manager ✅
- **文件选择**: file_picker ✅
- **安全存储**: flutter_secure_storage ✅
- **分享**: share_plus ✅

### 新增依赖
- **表达式计算**: expressions ✅
- **路径处理**: path ✅

---

## 🎯 里程碑

- ✅ **M1 (Week 1-2)**: 项目搭建 + 基础 OpenAI API 集成
- ✅ **M2 (Week 3-4)**: 基础聊天界面 + 本地存储
- ✅ **M3 (Week 5-6)**: 完整聊天功能 + 多平台适配
- ✅ **M4 (Week 7-8)**: 高级功能 + 设置页面
- ✅ **M5 (Week 9-10)**: MCP 支持(基础)
- ✅ **M6 (Week 11-12)**: Agent 功能 + 测试优化
- 🔄 **M7 (Week 13-14)**: 文档完善 + 发布准备

---

## 📊 当前状态

**开始日期**: 2024-10-12  
**最后更新**: 2024-10-13  
**当前阶段**: Phase 8 - 测试与优化  
**项目进度**: ~85% 完成

### 代码质量
- ✅ Flutter analyze: 0 errors, 2 warnings, 35 info
- ✅ 单元测试: 10+ 测试文件
- ✅ Git Hooks: Pre-commit 自动检查
- ✅ CI/CD: GitHub Actions 自动构建和测试

### 已完成功能模块
1. ✅ 核心架构和路由
2. ✅ OpenAI API 集成
3. ✅ 聊天界面和功能
4. ✅ 本地存储和数据管理
5. ✅ 多平台适配
6. ✅ MCP 集成
7. ✅ Agent 功能
8. ✅ 桌面端优化
9. ✅ Web 端 PWA
10. ✅ 测试框架

---

## 🚀 下一步计划

### 优先级 1 - 核心完善
- [ ] 完善 Agent 与聊天的实际集成
- [ ] 完善 MCP 与聊天的实际集成
- [ ] 添加更多集成测试

### 优先级 2 - 用户体验
- [ ] 添加离线功能支持
- [ ] 优化移动端键盘处理
- [ ] 添加无障碍功能

### 优先级 3 - 发布准备
- [ ] 编写用户使用文档
- [ ] 准备应用商店素材
- [ ] 配置自动更新机制

---

## 📝 注意事项

1. **安全性** ✅
   - API Key 已加密存储
   - 本地数据已加密
   - 数据清除功能已实现

2. **用户体验** ✅
   - 界面简洁直观
   - 详细的错误提示
   - 优雅的加载状态

3. **性能** 🔄
   - 长对话列表已优化
   - 大文件上传有进度提示
   - 消息分页加载待实现

4. **扩展性** ✅
   - 代码模块化
   - 依赖注入
   - MCP 和 Agent 接口已预留

